<style>
  #search-box {
    width: 100%;
    padding: 6px;
    font-size: 13px;
    margin-bottom: 10px;
    box-sizing: border-box;
  }

  ul#tabs-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  ul#tabs-list li {
    padding: 6px 8px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
  }

  ul#tabs-list li:hover {
    background-color: #f0f0f0;
  }
</style>

<input
  type="text"
  id="search-box"
  placeholder="Search tabs..."
  oninput="filterTabs()"
/>

<ul id="tabs-list">
  Loading tabs‚Ä¶
</ul>

<script>
  let allTabs = [];

  function renderTabs(tabs) {
    const list = document.getElementById("tabs-list");
    list.innerHTML = "";

    if (!Array.isArray(tabs)) {
      console.error("‚ùå renderTabs: tabs is not an array", tabs);
      list.innerHTML = "<li><em>Tab data error</em></li>";
      return;
    }

    if (tabs.length === 0) {
      list.innerHTML = "<li><em>No matching tabs</em></li>";
      return;
    }

    for (const tab of tabs) {
      const li = document.createElement("li");
      li.textContent = tab.name;
      li.onclick = () => {
        // Disable all list items temporarily
        document.querySelectorAll("#tabs-list li").forEach((item) => {
          item.style.pointerEvents = "none";
          item.style.opacity = "0.5";
        });

        li.textContent = `üîÑ Switching to "${tab.name}"...`;
        li.style.fontStyle = "italic";

        google.script.run
          .withSuccessHandler(() => {
            // Optional: restore pointer events after switch
            document.querySelectorAll("#tabs-list li").forEach((item) => {
              item.style.pointerEvents = "auto";
              item.style.opacity = "1";
            });
          })
          .activateTabLocal(tab.name);
      };
      list.appendChild(li);
    }
  }

  function filterTabs() {
    const query = document.getElementById("search-box").value.toLowerCase();
    const filtered = allTabs.filter((tab) =>
      tab.name.toLowerCase().includes(query)
    );
    renderTabs(filtered);
  }

  function activateTab(name) {
    console.log("üìç Activating tab:", name);
    google.script.run.activateTabLocal(name);
  }

  function loadTabs() {
    console.log("üì¶ Calling getAllTabsLocal...");
    google.script.run
      .withSuccessHandler((tabs) => {
        console.log("‚úÖ Tabs loaded:", tabs); // ‚Üê Will print null or array
        if (!tabs) console.error("‚ö†Ô∏è tabs is null or undefined");
        allTabs = tabs;
        renderTabs(tabs);
      })
      .withFailureHandler((err) => {
        console.error("‚ùå Failed to load tabs:", err);
        const list = document.getElementById("tabs-list");
        list.innerHTML =
          "<li><em>Error loading tabs. Check console for details.</em></li>";
      })
      .getAllTabsLocal();
  }

  console.log("üß™ Dumping available functions on google.script.run...");
  console.log(Object.keys(google.script.run));

  loadTabs();
</script>
